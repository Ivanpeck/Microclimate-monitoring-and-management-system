# Microclimate-monitoring-and-management-system

ВНИМАНИЕ: Проект не был завершен, и всвязи с этим не доработан до рабочего состояния. Но тем не менее прототип основного функционала разработан.


Эта система предназначена для автоматического сбора данных с датчиков через протокол Modbus TCP, их сохранения в базу данных PostgreSQL, визуализации, анализа и автоматического управления исполнительными механизмами (заслонками) для поддержания оптимальных параметров микроклимата в производственном помещении. Веб-интерфейс реализован на Streamlit.

## Основные функции
Сбор данных: Автоматическое чтение данных с ПЛК (Программируемого Логического Контроллера) по протоколу Modbus TCP.

Хранение данных: Сохранение всех показаний датчиков в реляционную базу данных PostgreSQL.

Визуализация: Построение графиков временных рядов и матриц корреляции для анализа данных.

Мониторинг: Автоматическое определение отклонений параметров (температура, влажность, поток) от заданных норм.

Автоматическое управление: Расчет и отправка команд на перемещение заслонки для компенсации выявленных отклонений.

Генерация отчетов: Автоматическое создание ZIP-архивов с HTML-отчетами на основе шаблонов.

Прогнозирование: Использование линейной регрессии для прогнозирования процента брака продукции на основе текущих параметров среды.

## Структура проекта
text
ваш-проект/
├── init.py                 # Приложение А: Основные алгоритмы и функции <br />
├── run_app.py             # Приложение Б: Веб-приложение на Streamlit <br />
├── config.json            # Приложение В: Файл конфигурации <br />
├── requirements.txt       # Список зависимостей (нужно создать) <br />
├── report template.htm    # Шаблон для генерации отчетов <br />
├── report template.files/ # Папка с ресурсами для шаблона (CSS, изображения) <br />
├── quality_data.csv       # Файл с историческими данными о качестве продукции <br />
└── README.md              # Этот файл
## Предварительные требования
Python: Установите Python 3.8 или новее.

PostgreSQL: Установите и запустите сервер PostgreSQL. Создайте базу данных для проекта.

ПЛК: В сети должен быть доступен ПЛК, поддерживающий протокол Modbus TCP.

Учетные данные: Подготовьте данные для подключения к БД и IP-адрес ПЛК.

## Установка и настройка
Клонируйте или скачайте файлы проекта в удобную директорию.

Создайте виртуальное окружение (рекомендуется):

bash <br />
python -m venv venv <br />
source venv/bin/activate  # Для Linux/MacOS <br />
venv\Scripts\activate     # Для Windows <br />
Установите зависимости: Создайте файл requirements.txt со следующим содержимым:

txt <br />
pymodbus==3.2.0 <br />
psycopg2-binary==2.9.7 <br />
streamlit==1.28.0 <br />
pandas==2.0.3 <br />
matplotlib==3.7.2 <br />
scikit-learn==1.3.0 <br />
beautifulsoup4==4.12.2 <br />
seaborn==0.12.2 <br />
Установите их командой:

bash <br />
pip install -r requirements.txt <br />
Настройте config.json:

Заполните параметры подключения к вашей базе данных PostgreSQL (dbname, user, password, host, port).

Укажите IP_PLC — IP-адрес вашего контроллера.

Для каждого параметра (например, "temp_1") укажите соответствующий адрес регистра Modbus на ПЛК (тип int).

Для каждого параметра задайте допустимые пределы значений *_limits (мин и макс, тип float).

Пример заполнения для нескольких параметров:

json <br />
{ <br />
  "dbname": "climate_db", <br />
  "user": "postgres", <br />
  "password": "mysecretpassword", <br />
  "host": "localhost", <br />
  "port": 5432, <br />
  "IP_PLC": "192.168.1.100", <br />
  "temp_1": 100, <br />
  "temp_1_limits": [20.5, 25.0], <br />
  ... <br />
} <br />
Подготовьте базу данных: Запустите SQL-скрипт для создания таблицы sensor_data. Структура таблицы должна соответствовать списку параметров в функции from_plc_to_sql() (столбцы temp_1, humidity_1, ..., created_at (должен быть с типом TIMESTAMP и значением по умолчанию CURRENT_TIMESTAMP).

Подготовьте данные о качестве: Заполните файл quality_data.csv историческими данными для обучения модели прогнозирования брака. Файл должен содержать колонки date, marriage (доля брака), а также колонки для типов изделий и цветов.

## Запуск приложения
Активируйте виртуальное окружение (если вы его создавали).

Запустите Streamlit-приложение:

bash <br />
streamlit run run_app.py <br />
Приложение автоматически откроется в вашем браузере по адресу http://localhost:8501.

## Использование
Главная страница: На главной странице отображается таблица с последними данными из БД.

Сбор данных: На боковой панели нажмите кнопку "Считать с ПЛК и записать в БД", чтобы вручную вызвать чтение данных с контроллера и сохранение в базу.

Визуализация:

Таблица данных: Можете выбрать столбцы для отображения и сортировать по любому полю.

Матрица корреляции: Позволяет увидеть взаимосвязи между различными параметрами.

Временной график: Выберите параметр и временной диапазон для построения графика.

Отчеты: Выберите время замера из выпадающего списка и нажмите "Скачать ZIP-отчёт". Будет сгенерирован и предложен для скачивания архив с HTML-отчетом.

Мониторинг: В разделе "Отклонения от нормы" в реальном времени отображаются текущие отклонения считанных параметров.

Управление: Включите тумблер "Автоматическое управление заслонкой". Система будет каждые 3600 секунд (1 час) проверять отклонения и, если они есть, рассчитывать новый угол для заслонки и отправлять команду на ПЛК. Журнал этих операций ведется в файле events.txt.

Прогнозирование: Введите тип изделий и цвета, производимые сегодня, чтобы получить прогноз процента брака на основе текущих условий.

## Основные модули (импортируемые функции из init.py)
from_plc_to_sql(): Чтение данных из ПЛК и запись в БД.

on_the_damper(deviations, flag): Расчет угла поворота заслонки и отправка команды на ПЛК.

glasses_seal(t): Генерация отчета в формате HTML и упаковка его в ZIP-архив для времени t.

monitoring_deviations(df): Анализ DataFrame и возврат отклонений последней записи от норм, заданных в config.json.

correlation_analysis(df): Построение матрицы корреляции для параметров в DataFrame.

using_time_series(df, param, start_time, end_time): Построение графика параметра param за выбранный период.

Model_painting(df): Класс для обучения и использования модели прогнозирования брака.
